(function(){"use strict";const E=11102230246251565e-32,y=134217729,rt=(3+8*E)*E;function U(i,t,n,e,l){let s,o,r,h,c=t[0],f=e[0],a=0,u=0;f>c==f>-c?(s=c,c=t[++a]):(s=f,f=e[++u]);let m=0;if(a<i&&u<n)for(f>c==f>-c?(o=c+s,r=s-(o-c),c=t[++a]):(o=f+s,r=s-(o-f),f=e[++u]),s=o,r!==0&&(l[m++]=r);a<i&&u<n;)f>c==f>-c?(o=s+c,h=o-s,r=s-(o-h)+(c-h),c=t[++a]):(o=s+f,h=o-s,r=s-(o-h)+(f-h),f=e[++u]),s=o,r!==0&&(l[m++]=r);for(;a<i;)o=s+c,h=o-s,r=s-(o-h)+(c-h),c=t[++a],s=o,r!==0&&(l[m++]=r);for(;u<n;)o=s+f,h=o-s,r=s-(o-h)+(f-h),f=e[++u],s=o,r!==0&&(l[m++]=r);return(s!==0||m===0)&&(l[m++]=s),m}function ot(i,t){let n=t[0];for(let e=1;e<i;e++)n+=t[e];return n}function R(i){return new Float64Array(i)}const at=(3+16*E)*E,lt=(2+12*E)*E,ct=(9+64*E)*E*E,N=R(4),$=R(8),k=R(12),tt=R(16),I=R(4);function ht(i,t,n,e,l,s,o){let r,h,c,f,a,u,m,M,x,p,d,g,X,B,Y,_,P,w;const b=i-l,v=n-l,A=t-s,S=e-s;B=b*S,u=y*b,m=u-(u-b),M=b-m,u=y*S,x=u-(u-S),p=S-x,Y=M*p-(B-m*x-M*x-m*p),_=A*v,u=y*A,m=u-(u-A),M=A-m,u=y*v,x=u-(u-v),p=v-x,P=M*p-(_-m*x-M*x-m*p),d=Y-P,a=Y-d,N[0]=Y-(d+a)+(a-P),g=B+d,a=g-B,X=B-(g-a)+(d-a),d=X-_,a=X-d,N[1]=X-(d+a)+(a-_),w=g+d,a=w-g,N[2]=g-(w-a)+(d-a),N[3]=w;let C=ot(4,N),F=lt*o;if(C>=F||-C>=F||(a=i-b,r=i-(b+a)+(a-l),a=n-v,c=n-(v+a)+(a-l),a=t-A,h=t-(A+a)+(a-s),a=e-S,f=e-(S+a)+(a-s),r===0&&h===0&&c===0&&f===0)||(F=ct*o+rt*Math.abs(C),C+=b*f+S*r-(A*c+v*h),C>=F||-C>=F))return C;B=r*S,u=y*r,m=u-(u-r),M=r-m,u=y*S,x=u-(u-S),p=S-x,Y=M*p-(B-m*x-M*x-m*p),_=h*v,u=y*h,m=u-(u-h),M=h-m,u=y*v,x=u-(u-v),p=v-x,P=M*p-(_-m*x-M*x-m*p),d=Y-P,a=Y-d,I[0]=Y-(d+a)+(a-P),g=B+d,a=g-B,X=B-(g-a)+(d-a),d=X-_,a=X-d,I[1]=X-(d+a)+(a-_),w=g+d,a=w-g,I[2]=g-(w-a)+(d-a),I[3]=w;const At=U(4,N,4,I,$);B=b*f,u=y*b,m=u-(u-b),M=b-m,u=y*f,x=u-(u-f),p=f-x,Y=M*p-(B-m*x-M*x-m*p),_=A*c,u=y*A,m=u-(u-A),M=A-m,u=y*c,x=u-(u-c),p=c-x,P=M*p-(_-m*x-M*x-m*p),d=Y-P,a=Y-d,I[0]=Y-(d+a)+(a-P),g=B+d,a=g-B,X=B-(g-a)+(d-a),d=X-_,a=X-d,I[1]=X-(d+a)+(a-_),w=g+d,a=w-g,I[2]=g-(w-a)+(d-a),I[3]=w;const St=U(At,$,4,I,k);B=r*f,u=y*r,m=u-(u-r),M=r-m,u=y*f,x=u-(u-f),p=f-x,Y=M*p-(B-m*x-M*x-m*p),_=h*c,u=y*h,m=u-(u-h),M=h-m,u=y*c,x=u-(u-c),p=c-x,P=M*p-(_-m*x-M*x-m*p),d=Y-P,a=Y-d,I[0]=Y-(d+a)+(a-P),g=B+d,a=g-B,X=B-(g-a)+(d-a),d=X-_,a=X-d,I[1]=X-(d+a)+(a-_),w=g+d,a=w-g,I[2]=g-(w-a)+(d-a),I[3]=w;const Et=U(St,k,4,I,tt);return tt[Et-1]}function ft(i,t,n,e,l,s){const o=(t-s)*(n-l),r=(i-l)*(e-s),h=o-r,c=Math.abs(o+r);return Math.abs(h)>=at*c?h:-ht(i,t,n,e,l,s,c)}function ut(i,t){var n,e,l=0,s,o,r,h,c,f,a,u=i[0],m=i[1],M=t.length;for(n=0;n<M;n++){e=0;var x=t[n],p=x.length-1;if(f=x[0],f[0]!==x[p][0]&&f[1]!==x[p][1])throw new Error("First and last coordinates in a ring must be the same");for(o=f[0]-u,r=f[1]-m,e;e<p;e++){if(a=x[e+1],h=a[0]-u,c=a[1]-m,r===0&&c===0){if(h<=0&&o>=0||o<=0&&h>=0)return 0}else if(c>=0&&r<=0||c<=0&&r>=0){if(s=ft(o,h,r,c,0,0),s===0)return 0;(s>0&&c>0&&r<=0||s<0&&c<=0&&r>0)&&l++}f=a,r=c,o=h}}return l%2!==0}function mt(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return[...i.geometry.coordinates];if(i.type==="Point")return[...i.coordinates]}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return[...i];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function xt(i){return i.type==="Feature"?i.geometry:i}function dt(i,t,n={}){if(!i)throw new Error("point is required");if(!t)throw new Error("polygon is required");const e=mt(i),l=xt(t),s=l.type,o=t.bbox;let r=l.coordinates;if(o&&Mt(e,o)===!1)return!1;s==="Polygon"&&(r=[r]);let h=!1;for(var c=0;c<r.length;++c){const f=ut(e,r[c]);if(f===0)return!n.ignoreBoundary;f&&(h=!0)}return h}function Mt(i,t){return t[0]<=i[0]&&t[1]<=i[1]&&t[2]>=i[0]&&t[3]>=i[1]}var pt=dt;function nt(i,t,n=0,e=i.length-1,l=gt){for(;e>n;){if(e-n>600){const h=e-n+1,c=t-n+1,f=Math.log(h),a=.5*Math.exp(2*f/3),u=.5*Math.sqrt(f*a*(h-a)/h)*(c-h/2<0?-1:1),m=Math.max(n,Math.floor(t-c*a/h+u)),M=Math.min(e,Math.floor(t+(h-c)*a/h+u));nt(i,t,m,M,l)}const s=i[t];let o=n,r=e;for(q(i,n,t),l(i[e],s)>0&&q(i,n,e);o<r;){for(q(i,o,r),o++,r--;l(i[o],s)<0;)o++;for(;l(i[r],s)>0;)r--}l(i[n],s)===0?q(i,n,r):(r++,q(i,r,e)),r<=t&&(n=r+1),t<=r&&(e=r-1)}}function q(i,t,n){const e=i[t];i[t]=i[n],i[n]=e}function gt(i,t){return i<t?-1:i>t?1:0}class Bt{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let n=this.data;const e=[];if(!Q(t,n))return e;const l=this.toBBox,s=[];for(;n;){for(let o=0;o<n.children.length;o++){const r=n.children[o],h=n.leaf?l(r):r;Q(t,h)&&(n.leaf?e.push(r):H(t,h)?this._all(r,e):s.push(r))}n=s.pop()}return e}collides(t){let n=this.data;if(!Q(t,n))return!1;const e=[];for(;n;){for(let l=0;l<n.children.length;l++){const s=n.children[l],o=n.leaf?this.toBBox(s):s;if(Q(t,o)){if(n.leaf||H(t,o))return!0;e.push(s)}}n=e.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let n=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=n;else if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const e=this.data;this.data=n,n=e}this._insert(n,this.data.height-n.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=O([]),this}remove(t,n){if(!t)return this;let e=this.data;const l=this.toBBox(t),s=[],o=[];let r,h,c;for(;e||s.length;){if(e||(e=s.pop(),h=s[s.length-1],r=o.pop(),c=!0),e.leaf){const f=yt(t,e.children,n);if(f!==-1)return e.children.splice(f,1),s.push(e),this._condense(s),this}!c&&!e.leaf&&H(e,l)?(s.push(e),o.push(r),r=0,h=e,e=e.children[0]):h?(r++,e=h.children[r],c=!1):e=null}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,n){const e=[];for(;t;)t.leaf?n.push(...t.children):e.push(...t.children),t=e.pop();return n}_build(t,n,e,l){const s=e-n+1;let o=this._maxEntries,r;if(s<=o)return r=O(t.slice(n,e+1)),D(r,this.toBBox),r;l||(l=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,l-1))),r=O([]),r.leaf=!1,r.height=l;const h=Math.ceil(s/o),c=h*Math.ceil(Math.sqrt(o));it(t,n,e,c,this.compareMinX);for(let f=n;f<=e;f+=c){const a=Math.min(f+c-1,e);it(t,f,a,h,this.compareMinY);for(let u=f;u<=a;u+=h){const m=Math.min(u+h-1,a);r.children.push(this._build(t,u,m,l-1))}}return D(r,this.toBBox),r}_chooseSubtree(t,n,e,l){for(;l.push(n),!(n.leaf||l.length-1===e);){let s=1/0,o=1/0,r;for(let h=0;h<n.children.length;h++){const c=n.children[h],f=z(c),a=_t(t,c)-f;a<o?(o=a,s=f<s?f:s,r=c):a===o&&f<s&&(s=f,r=c)}n=r||n.children[0]}return n}_insert(t,n,e){const l=e?t:this.toBBox(t),s=[],o=this._chooseSubtree(l,this.data,n,s);for(o.children.push(t),T(o,l);n>=0&&s[n].children.length>this._maxEntries;)this._split(s,n),n--;this._adjustParentBBoxes(l,s,n)}_split(t,n){const e=t[n],l=e.children.length,s=this._minEntries;this._chooseSplitAxis(e,s,l);const o=this._chooseSplitIndex(e,s,l),r=O(e.children.splice(o,e.children.length-o));r.height=e.height,r.leaf=e.leaf,D(e,this.toBBox),D(r,this.toBBox),n?t[n-1].children.push(r):this._splitRoot(e,r)}_splitRoot(t,n){this.data=O([t,n]),this.data.height=t.height+1,this.data.leaf=!1,D(this.data,this.toBBox)}_chooseSplitIndex(t,n,e){let l,s=1/0,o=1/0;for(let r=n;r<=e-n;r++){const h=L(t,0,r,this.toBBox),c=L(t,r,e,this.toBBox),f=wt(h,c),a=z(h)+z(c);f<s?(s=f,l=r,o=a<o?a:o):f===s&&a<o&&(o=a,l=r)}return l||e-n}_chooseSplitAxis(t,n,e){const l=t.leaf?this.compareMinX:Xt,s=t.leaf?this.compareMinY:Yt,o=this._allDistMargin(t,n,e,l),r=this._allDistMargin(t,n,e,s);o<r&&t.children.sort(l)}_allDistMargin(t,n,e,l){t.children.sort(l);const s=this.toBBox,o=L(t,0,n,s),r=L(t,e-n,e,s);let h=J(o)+J(r);for(let c=n;c<e-n;c++){const f=t.children[c];T(o,t.leaf?s(f):f),h+=J(o)}for(let c=e-n-1;c>=n;c--){const f=t.children[c];T(r,t.leaf?s(f):f),h+=J(r)}return h}_adjustParentBBoxes(t,n,e){for(let l=e;l>=0;l--)T(n[l],t)}_condense(t){for(let n=t.length-1,e;n>=0;n--)t[n].children.length===0?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():D(t[n],this.toBBox)}}function yt(i,t,n){if(!n)return t.indexOf(i);for(let e=0;e<t.length;e++)if(n(i,t[e]))return e;return-1}function D(i,t){L(i,0,i.children.length,t,i)}function L(i,t,n,e,l){l||(l=O(null)),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let s=t;s<n;s++){const o=i.children[s];T(l,i.leaf?e(o):o)}return l}function T(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function Xt(i,t){return i.minX-t.minX}function Yt(i,t){return i.minY-t.minY}function z(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function J(i){return i.maxX-i.minX+(i.maxY-i.minY)}function _t(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function wt(i,t){const n=Math.max(i.minX,t.minX),e=Math.max(i.minY,t.minY),l=Math.min(i.maxX,t.maxX),s=Math.min(i.maxY,t.maxY);return Math.max(0,l-n)*Math.max(0,s-e)}function H(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Q(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function O(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function it(i,t,n,e,l){const s=[t,n];for(;s.length;){if(n=s.pop(),t=s.pop(),n-t<=e)continue;const o=t+Math.ceil((n-t)/e/2)*e;nt(i,o,t,n,l),s.push(t,o,o,n)}}const K=self;let j=[];const V=new Bt;let et=null;K.addEventListener("message",i=>{const t=i.data;if(t.type==="build-index"){j=t.polygons;const n=[];j.forEach((e,l)=>{const s=e.bbox??W(e);n.push({minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],idx:l})}),V.clear(),V.load(n),K.postMessage({type:"ready"})}if(t.type==="loc-update"){const{coord:n,heading:e}=t,l=Z(n.lng,n.lat);l&&(et=l);const s=typeof e=="number"&&!Number.isNaN(e)?e:0,o=h=>(h%360+360)%360,r={top:G(n,o(s)),bottom:G(n,o(s+180)),left:G(n,o(s-90)),right:G(n,o(s+90))};K.postMessage({type:"loc-result",suburbName:et,nextDirs:r})}});function W(i){let t=1/0,n=1/0,e=-1/0,l=-1/0;const s=o=>{for(const r of o)for(const[h,c]of r)h<t&&(t=h),c<n&&(n=c),h>e&&(e=h),c>l&&(l=c)};if(i.geometry.type==="Polygon")s(i.geometry.coordinates);else for(const o of i.geometry.coordinates)s(o);return[t,n,e,l]}function Z(i,t){const n=V.search({minX:i,minY:t,maxX:i,maxY:t});for(const e of n){const l=j[e.idx];if(pt([i,t],l))return l.properties.name}return null}function G(i,t){const n=Z(i.lng,i.lat),e=25,l=1e4;let s=0;const o=t*Math.PI/180,h=1/(111320*Math.cos(i.lat*Math.PI/180)),c=1/110540;let f=i.lng,a=i.lat;for(;s<=l;){f+=Math.sin(o)*e*h,a+=Math.cos(o)*e*c,s+=e;const m=Z(f,a);if(m&&m!==n)return{name:m,distM:s}}const u=j.map((m,M)=>({f:m,idx:M,center:It(m.bbox??W(m))})).filter(m=>m.f.properties.name!==n).map(m=>{const M=Pt(i,{lng:m.center[0],lat:m.center[1]}),x=bt(t,M),p=vt(i,m.f.bbox??W(m.f));return{name:m.f.properties.name,ang:x,dist:p}}).filter(m=>m.ang<=60).sort((m,M)=>m.dist-M.dist);return u.length>0?{name:u[0].name,distM:u[0].dist}:{name:null,distM:null}}function It(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Pt(i,t){const n=Math.sin((t.lng-i.lng)*Math.PI/180)*Math.cos(t.lat*Math.PI/180),e=Math.cos(i.lat*Math.PI/180)*Math.sin(t.lat*Math.PI/180)-Math.sin(i.lat*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.cos((t.lng-i.lng)*Math.PI/180);return(Math.atan2(n,e)*180/Math.PI+360)%360}function bt(i,t){let n=Math.abs(i-t)%360;return n>180&&(n=360-n),n}function vt(i,t){const n=Math.cos(i.lat*Math.PI/180),e=m=>(m-i.lng)*111320*n,l=m=>(m-i.lat)*110540,s=0,o=0,r=e(t[0]),h=l(t[1]),c=e(t[2]),f=l(t[3]),a=st(s,Math.min(r,c),Math.max(r,c)),u=st(o,Math.min(h,f),Math.max(h,f));return Math.hypot(s-a,o-u)}function st(i,t,n){return Math.max(t,Math.min(n,i))}})();
//# sourceMappingURL=geo-worker-ByCpZBgh.js.map
